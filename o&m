Sure! Let's replace Grafana and Prometheus with Splunk, Dynatrace, or OBM (Operations Bridge Manager) to collect, analyze, and correlate traces, metrics, and logs in your Spring Boot API application.


---

ğŸ”¹ Updated Tech Stack

Instead of Prometheus & Grafana, we'll now use: âœ… Traces â†’ Dynatrace OneAgent or OpenTelemetry with Splunk APM
âœ… Metrics â†’ Dynatrace, Splunk Observability, or OBM
âœ… Logs â†’ Splunk or OBM


---

ğŸ”¹ Step 1: Set Up OpenTelemetry in Spring Boot

1ï¸âƒ£ Add OpenTelemetry & Splunk/Dynatrace Dependencies

Update your pom.xml:

<dependency>
    <groupId>io.opentelemetry</groupId>
    <artifactId>opentelemetry-exporter-otlp</artifactId>
    <version>1.24.0</version>
</dependency>
<dependency>
    <groupId>com.splunk</groupId>
    <artifactId>splunk-otel-java</artifactId>
    <version>1.14.0</version>
</dependency>
<dependency>
    <groupId>com.dynatrace.opentelemetry</groupId>
    <artifactId>dynatrace-opentelemetry</artifactId>
    <version>1.9.0</version>
</dependency>


---

2ï¸âƒ£ Configure OpenTelemetry for Splunk/Dynatrace (application.yml)

For Splunk

otel:
  service:
    name: "springboot-api"
  exporter:
    otlp:
      endpoint: "http://splunk-otel-collector:4317"

For Dynatrace

otel:
  exporter:
    otlp:
      endpoint: "https://your-dynatrace-tenant/api/v2/otlp"
      headers:
        Authorization: "Api-Token YOUR_DYNATRACE_API_TOKEN"


---

ğŸ”¹ Step 2: Set Up API Logging and Monitoring

Modify your Spring Boot Controller to track API failures, logs, traces, and latency.

import io.opentelemetry.api.trace.Span;
import io.opentelemetry.api.trace.Tracer;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.web.bind.annotation.*;

@RestController
@RequestMapping("/api")
public class PaymentController {

    private static final Logger logger = LoggerFactory.getLogger(PaymentController.class);
    private final Tracer tracer;

    public PaymentController(Tracer tracer) {
        this.tracer = tracer;
    }

    @GetMapping("/processPayment/{customerId}")
    public String processPayment(@PathVariable String customerId) {
        Span span = tracer.spanBuilder("ProcessPaymentAPI").startSpan();
        span.setAttribute("customer.id", customerId);

        try {
            long start = System.currentTimeMillis();

            if (Math.random() < 0.3) {  // Simulating 30% API failure
                throw new RuntimeException("Payment gateway error!");
            }

            Thread.sleep(200);  // Simulate processing delay
            String paymentId = "PAY-" + System.currentTimeMillis();

            long duration = System.currentTimeMillis() - start;
            span.setAttribute("response.time.ms", duration);
            span.setAttribute("payment.id", paymentId);

            logger.info("Payment Successful for Customer: {}", customerId);

            return "Payment Successful! Payment ID: " + paymentId;
        } catch (Exception e) {
            span.recordException(e);
            span.setAttribute("error", true);
            logger.error("Payment failed for Customer: {}. Error: {}", customerId, e.getMessage());
            throw new RuntimeException("Payment failed!");
        } finally {
            span.end();
        }
    }
}


---

ğŸ”¹ Step 3: Configure Splunk/Dynatrace for Logs and Metrics

1ï¸âƒ£ Configure Splunk Log Forwarding

For Splunk HEC (HTTP Event Collector)

Modify logback.xml to send logs to Splunk:

<configuration>
    <appender name="SPLUNK" class="com.splunk.logging.HttpEventCollectorLogbackAppender">
        <url>https://your-splunk-url:8088</url>
        <token>Your-Splunk-HEC-Token</token>
        <index>your-index</index>
        <sourcetype>spring-boot-logs</sourcetype>
    </appender>

    <root level="info">
        <appender-ref ref="SPLUNK"/>
    </root>
</configuration>

ğŸ“Œ Splunk Query to Monitor API Failures

index="your-index" sourcetype="spring-boot-logs" "Payment failed"


---

2ï¸âƒ£ Configure Dynatrace OneAgent

Run Dynatrace OneAgent on your server

wget -O Dynatrace-OneAgent.sh "https://your-dynatrace-url/api/v1/deployment/installer/agent/unix/latest?arch=x86&flavor=default"
chmod +x Dynatrace-OneAgent.sh
sudo ./Dynatrace-OneAgent.sh

ğŸ” Check Logs in Dynatrace:

Navigate to: Dynatrace > Log Monitoring

Query: ProcessPaymentAPI AND error:true



---

3ï¸âƒ£ Configure OBM for Log Collection

Install OBM Agent

wget -O obm-agent.sh "https://your-obm-url/install.sh"
chmod +x obm-agent.sh
sudo ./obm-agent.sh

Go to OBM Console > Log Insights

Search "ProcessPaymentAPI failed"



---

ğŸ”¹ Step 4: View API Traces, Metrics, and Logs

ğŸ” In Splunk

Traces â†’ Search ProcessPaymentAPI

Logs â†’ Search "Payment failed"

Metrics â†’ Search avg(response.time.ms)


ğŸ” In Dynatrace

Traces â†’ View API trace (ProcessPaymentAPI)

Logs â†’ Go to Log Monitoring

Metrics â†’ View response.time.ms


ğŸ” In OBM

Traces â†’ Application Performance Monitoring

Logs â†’ Log Analytics

Metrics â†’ API Failure Rate



---

ğŸš€ Summary: What We Achieved

âœ… Captured API Failures, Traces, and Latency
âœ… Stored Logs in Splunk/Dynatrace/OBM
âœ… Correlated Logs, Metrics, and Traces
âœ… Visualized API Failures Without Prometheus/Grafana


---

ğŸ’¡ Next Steps

Would you like a pre-configured Splunk or Dynatrace dashboard JSON for easy import? ğŸš€

